# Linear Regression
```{r setup, include=FALSE}
library(tidyverse)
library(ggpubr)
source("load_data.R")
```


## Introduction
The question for linear regression is what factors influence in-state tuition at U.S. universities. We will examine the factors influencing the total in-state tuition and fees for main campus, four year, degree granting insitutions.

Our primary response variable is `TUITIONFEE_IN` -- the total tuition and fees for in-state students in US dollars.

The cost of attending college is one of the main concerns for high school students planning for undergraduate studies. Tuition and fees have significantly increased over the past decade which resulted in increased student debts and an increase in student loans: 

* Total $1.75 trillion in student loan debt (including federal and private loans)
* On average, each borrower owes $28,950 
* About 92% of all student debt are federal student loans
* More than half (55%) of students from public four-year institutions had student loans

With the above facts, it is important that we understand the factors that influence high tuition fees. These factors that impact the fees needs to be addressed to encourage the current and future generations can have a debt-free college education of their choice. 

References:
https://studentloanhero.com/featured/undergrad-worries-survey/
https://educationdata.org/student-loan-debt-crisis

## Visualizations

Some initial scatterplots across the various variables can help show provide insight to some initial relationship. None of the predictor variables display an obvious linear relation ship to in-state tuition during this first pass. There are some predictors where the scatterplot looks to be creating a "C" sort of shape. We will explor those variables furhter while also including some of those categorical variables later. The most obvious relationships are between the Math, Reading, and Writing Median SAT scores. They are all positively correlated with each other. Admission Rate also looks to have a relationship with those same three variables though it is negatively correlated.
```{r, echo=FALSE}
pairs(data[,c("TUITIONFEE_IN","ADM_RATE","UGDS","INEXPFTE","AVGFACSAL","PFTFAC")], lower.panel = NULL)
```

```{r, echo=FALSE}
pairs(data[,c("TUITIONFEE_IN","PCTPELL","PCTFLOAN","RET_FT4","GRAD_DEBT_MDN")], lower.panel = NULL)
```

The plots below illustrate the impact of control on the relationship between various predictor variables and in-state tuition. It helps explain the "C" shape we were seeing in some of the earlier scatter plots. It looks like the estimated slopes for some of these relationships will vary depending on whether the school is public or private.
```{r, echo=FALSE}
admscp <- data %>%
  select(ADM_RATE, TUITIONFEE_IN, CONTROL) %>% 
  drop_na() %>% 
  ggplot(aes(x = ADM_RATE, y = TUITIONFEE_IN, color = CONTROL)) +
    scale_x_continuous(labels = scales::label_percent()) + 
    scale_y_continuous(labels = scales::label_dollar()) + 
    geom_point(alpha = 0.5) +
    labs(
      title = "Tuition vs. Admission Rate",
      x = "Admission Rate",
      y = "In-State Tuition",
      color = "Insitution Type"
    ) + theme_bw()

ugdsscp <- data %>%
  select(UGDS, TUITIONFEE_IN, CONTROL) %>% 
  drop_na() %>% 
  ggplot(aes(x = UGDS, y = TUITIONFEE_IN, color = CONTROL)) +
    scale_x_continuous() + 
    scale_y_continuous(labels = scales::label_dollar()) + 
    geom_point(alpha = 0.5) +
    labs(
      title = "Tuition vs. Undergrad Students",
      x = "Undergrad Students",
      y = "In-State Tuition",
      color = "Insitution Type"
    ) + theme(axis.text.x = element_text(angle = 90))

avgfacsalscp <- data %>%
  select(AVGFACSAL, TUITIONFEE_IN, CONTROL) %>% 
  drop_na() %>%
  ggplot(., aes(x = AVGFACSAL, y = TUITIONFEE_IN,  color = CONTROL)) +
    scale_x_continuous(labels = scales::label_dollar()) +
    scale_y_continuous(labels = scales::label_dollar()) + 
    geom_point(alpha = 0.5) +
    labs(
      title = "Tuition vs. Average Faculty Salary",
      x = "Avg. Faculty Salary (USD per month)",
      y = "In-State Tuition",
      color = "Insitution Type"
    ) + theme(axis.text.x = element_text(angle = 90))

pftfacscp <- data %>%
  select(PFTFAC, TUITIONFEE_IN, CONTROL) %>% 
  drop_na() %>%
  ggplot(., aes(x = PFTFAC, y = TUITIONFEE_IN,  color = CONTROL)) +
    scale_x_continuous(labels = scales::label_percent()) +
    scale_y_continuous(labels = scales::label_dollar()) + 
    geom_point(alpha = 0.5) +
    labs(
      title = "Tuition vs. Full Time Faculty",
      x = "Percentage Full Time Faculty",
      y = "In-State Tuition",
      color = "Insitution Type"
    ) + theme_bw()

ggarrange(admscp, ugdsscp, avgfacsalscp, pftfacscp,
          ncol = 2, nrow = 2)
```

```{r, echo=FALSE}
pctpellscp <- data %>%
  select(PCTPELL, TUITIONFEE_IN, CONTROL) %>% 
  drop_na() %>%
  ggplot(., aes(x = PCTPELL, y = TUITIONFEE_IN,  color = CONTROL)) +
    scale_x_continuous(labels = scales::label_percent()) + 
    scale_y_continuous(labels = scales::label_dollar()) + 
    geom_point(alpha = 0.5) +
    labs(
      title = "Tuition vs. Percent Pell Grant",
      x = "Pell Grant Rate",
      y = "In-State Tuition",
      color = "Insitution Type"
    ) + theme_bw()

pctflscp <- data %>%
  select(PCTFLOAN, TUITIONFEE_IN, CONTROL) %>% 
  drop_na() %>%
  ggplot(., aes(x = PCTFLOAN, y = TUITIONFEE_IN,  color = CONTROL)) +
    scale_x_continuous(labels = scales::label_percent()) + 
    scale_y_continuous(labels = scales::label_dollar()) + 
    geom_point(alpha = 0.5) +
    labs(
      title = "Tuition vs. Percent Student Loan",
      x = "Student Loan Rate",
      y = "In-State Tuition",
      color = "Insitution Type"
    ) + theme_bw()

retft4scp <- data %>%
  select(RET_FT4, TUITIONFEE_IN, CONTROL) %>% 
  drop_na() %>%
  ggplot(., aes(x = RET_FT4, y = TUITIONFEE_IN,  color = CONTROL)) +
    scale_x_continuous(labels = scales::label_percent()) + 
    scale_y_continuous(labels = scales::label_dollar()) + 
    geom_point(alpha = 0.5) +
    labs(
      title = "Tuition vs. Rate First Time Undergrads",
      x = "First Time Undergrad Rate",
      y = "In-State Tuition",
      color = "Insitution Type"
    ) + theme_bw()

gdmfcp <- data %>%
  select(GRAD_DEBT_MDN, TUITIONFEE_IN, CONTROL) %>% 
  drop_na() %>%
  ggplot(., aes(x = GRAD_DEBT_MDN, y = TUITIONFEE_IN,  color = CONTROL)) +
    scale_x_continuous(labels = scales::label_dollar()) + 
    scale_y_continuous(labels = scales::label_dollar()) + 
    geom_point(alpha = 0.5) +
    labs(
      title = "Tuition vs. Median Graduation Debt",
      x = "Median Graduation Debt",
      y = "In-State Tuition",
      color = "Insitution Type"
    ) + theme(axis.text.x = element_text(angle = 90))

ggarrange(pctpellscp, pctflscp, retft4scp, gdmfcp,
          ncol = 2, nrow =2)
```
From the plot below it's not obvious whether a school being single gender or religious will affect the price of in-state tuition.
```{r, echo=FALSE}
data %>%
  select(SINGLEGENDER, TUITIONFEE_IN, CONTROL, RELIGIOUS) %>% 
  drop_na() %>%
  ggplot(., aes(x = SINGLEGENDER, y = TUITIONFEE_IN, fill = RELIGIOUS)) +
    geom_violin() +
    labs(
      title = "Tuition vs. Single Gender and Religous Schools",
      x = "Single Gender",
      y = "In-State Tuition",
    ) + theme_bw()
```
```{r, echo=FALSE}
data %>%
  select(LOCALE, TUITIONFEE_IN, CONTROL) %>% 
  drop_na() %>%
  ggplot(., aes(x = LOCALE, y = TUITIONFEE_IN, fill = CONTROL)) +
    geom_violin() +
    labs(
      title = "Tuition vs. LOCALE and CONTROL",
      x = "Locale",
      y = "In-State Tuition",
    ) + theme_bw()
```

## Model Building

### Initial Model
We know we want to include interaction terms with CONTROL and other predictors. Becasue of that we know that we will not be able to rely on the automated search procedures we've used previously. So the initial model will start off as a first order model including predictors identified from the charts shown previously. These predictors are SATVRMID, AVGFACSAL, PCTPELL, RET_FT4, and CONTROL. We will also attempt to avoid predictors that are highly correlated with each other. SATMTMMID, SATWRMID, and ADM_RATE are not included because they are highly correlated with SATMTMID. PCFTLOAN was not included because it looks to be correlated with PCTPELL.
```{r, echo=FALSE}
initmodel <- lm(TUITIONFEE_IN~ADM_RATE+AVGFACSAL+PCTPELL+RET_FT4+CONTROL, data = data)
summary(initmodel)
```

### Improved Model
After creating the first oder model we will attempt to improve it using interaction terms with CONTROL. From the initial model based on the t-test it looks like we can likely remove RET_FT4 from the model. However we will see if there is a significant coefficient for the interaction term between RET_FT4 and CONTROL before removing it from the model.
```{r, echo=FALSE}
impmodel1 <- lm(TUITIONFEE_IN~ADM_RATE+AVGFACSAL+PCTPELL+RET_FT4+CONTROL+
                  ADM_RATE:CONTROL+AVGFACSAL:CONTROL+PCTPELL:CONTROL+RET_FT4:CONTROL, data = data)
summary(impmodel1)
```




### Recommended Model

### Regression Assumptions and Influential Points

## Conclusions